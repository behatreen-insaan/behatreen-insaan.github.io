<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CV Builder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.5.0/docx.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.tiny.cloud/1/hk4nb8y38mlhe25ff58ya0ayvywzctp39caeutkzjqp3ws4g/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    textarea, input { width: 100%; margin-bottom: 15px; padding: 8px; font-size: 14px; }
    button { padding: 10px 15px; margin-right: 10px; cursor: pointer; font-size: 14px; }
    .work-experience, .education { margin-bottom: 15px; }
    .section { display: flex; align-items: center; }
    .section input { margin-right: 5px; }
    .section button { margin-left: 5px; }
  </style>
</head>
<body>
  <h1>CV Builder</h1>

  <label>Name:</label>
  <input type="text" id="name" placeholder="Enter your name">

  <label>Contact:</label>
  <div class="section">
    <select id="country-code">
      <option value="+60">+60 (Malaysia)</option>
      <option value="+1">+1 (USA)</option>
      <option value="+44">+44 (UK)</option>
      <!-- Add more country codes as needed -->
    </select>
    <input type="text" id="contact" placeholder="Enter your contact number">
  </div>

  <label>Email:</label>
  <input type="email" id="email" placeholder="Enter your email">

  <label>Social Media Link:</label>
  <input type="url" id="social-media" placeholder="Enter your social media link">

  <label>Professional Summary:</label>
  <textarea id="summary"></textarea>

  <label>Work Experience:</label>
  <div id="work-experience-container">
    <div class="work-experience">
      <input type="text" placeholder="Job Title">
      <input type="text" placeholder="Company">
      <input type="date" placeholder="From Date">
      <input type="date" placeholder="To Date">
      <button onclick="removeWorkExperience(this)">Delete</button>
    </div>
  </div>
  <button onclick="addWorkExperience()">Add Work Experience</button>

  <label>Education:</label>
  <div id="education-container">
    <div class="education">
      <input type="text" placeholder="Degree/Qualification">
      <input type="text" placeholder="Institution">
      <input type="date" placeholder="Start Date">
      <input type="date" placeholder="End Date">
      <button onclick="removeEducation(this)">Delete</button>
    </div>
  </div>
  <button onclick="addEducation()">Add Education</button>

  <label>Skills:</label>
  <textarea id="skills"></textarea>

  <label>Certifications:</label>
  <textarea id="certifications"></textarea>

  <label>Projects:</label>
  <textarea id="projects"></textarea>

  <label>Languages (optional):</label>
  <textarea id="languages"></textarea>

  <label>Publications (for academics):</label>
  <textarea id="publications"></textarea>

  <button onclick="generateDocx()">Save as DOCX</button>
  <button onclick="generatePDF()">Save as PDF</button>

  <script>
    async function generateDocx() {
      const { Document, Packer, Paragraph, TextRun, HeadingLevel } = window.docx;
      const doc = new Document();

      // Get the values for dynamic fields
      const name = document.getElementById('name').value;
      const contact = document.getElementById('country-code').value + ' ' + document.getElementById('contact').value;
      const email = document.getElementById('email').value;
      const socialMedia = document.getElementById('social-media').value;
      const summary = document.getElementById('summary').value;
      const skills = document.getElementById('skills').value;
      const certifications = document.getElementById('certifications').value;
      const projects = document.getElementById('projects').value;
      const languages = document.getElementById('languages').value;
      const publications = document.getElementById('publications').value;

      // Work experience and education entries
      const workExperience = Array.from(document.getElementsByClassName('work-experience')).map(work => ({
        title: work.querySelector('input:nth-child(1)').value,
        company: work.querySelector('input:nth-child(2)').value,
        fromDate: work.querySelector('input:nth-child(3)').value,
        toDate: work.querySelector('input:nth-child(4)').value,
      }));

      const educationEntries = Array.from(document.getElementsByClassName('education')).map(edu => ({
        degree: edu.querySelector('input:nth-child(1)').value,
        institution: edu.querySelector('input:nth-child(2)').value,
        startDate: edu.querySelector('input:nth-child(3)').value,
        endDate: edu.querySelector('input:nth-child(4)').value,
      }));

      const children = [];

      // Add basic information (Name, Contact, Email, Social Media)
      children.push(new Paragraph({ text: name, heading: HeadingLevel.HEADING_1 }));
      children.push(new Paragraph(`Contact: ${contact}`));
      children.push(new Paragraph(`Email: ${email}`));
      children.push(new Paragraph(`Social Media: ${socialMedia}`));

      // Add Professional Summary
      if (summary.trim()) {
        children.push(new Paragraph({ text: 'Professional Summary', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: summary }));
      }

      // Add Work Experience
      if (workExperience.length > 0) {
        children.push(new Paragraph({ text: 'Work Experience', heading: HeadingLevel.HEADING_2 }));
        workExperience.forEach(work => {
          children.push(new Paragraph({ text: `${work.title} at ${work.company} (${work.fromDate} to ${work.toDate})` }));
        });
      }

      // Add Education
      if (educationEntries.length > 0) {
        children.push(new Paragraph({ text: 'Education', heading: HeadingLevel.HEADING_2 }));
        educationEntries.forEach(edu => {
          children.push(new Paragraph({ text: `${edu.degree} from ${edu.institution} (${edu.startDate} to ${edu.endDate})` }));
        });
      }

      // Add Skills, Certifications, Projects, Languages, and Publications
      if (skills.trim()) {
        children.push(new Paragraph({ text: 'Skills', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: skills }));
      }
      if (certifications.trim()) {
        children.push(new Paragraph({ text: 'Certifications', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: certifications }));
      }
      if (projects.trim()) {
        children.push(new Paragraph({ text: 'Projects', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: projects }));
      }
      if (languages.trim()) {
        children.push(new Paragraph({ text: 'Languages', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: languages }));
      }
      if (publications.trim()) {
        children.push(new Paragraph({ text: 'Publications', heading: HeadingLevel.HEADING_2 }));
        children.push(new Paragraph({ text: publications }));
      }

      // Generate and save the document
      doc.addSection({ children });
      const blob = await Packer.toBlob(doc);
      saveAs(blob, "CV.docx");
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont("helvetica", "normal");

      const name = document.getElementById('name').value;
      const contact = document.getElementById('country-code').value + ' ' + document.getElementById('contact').value;
      const email = document.getElementById('email').value;
      const socialMedia = document.getElementById('social-media').value;
      const summary = document.getElementById('summary').value;
      const skills = document.getElementById('skills').value;
      const certifications = document.getElementById('certifications').value;
      const projects = document.getElementById('projects').value;
      const languages = document.getElementById('languages').value;
      const publications = document.getElementById('publications').value;

      let y = 10;

      // Add Name, Contact, Email, Social Media
      doc.setFontSize(16);
      doc.text(name, 10, y);
      y += 10;
      doc.setFontSize(12);
      doc.text(`Contact: ${contact}`, 10, y);
      y += 5;
      doc.text(`Email: ${email}`, 10, y);
      y += 5;
      doc.text(`Social Media: ${socialMedia}`, 10, y);
      y += 10;

      // Add Professional Summary
      if (summary.trim()) {
        doc.setFontSize(14);
        doc.text("Professional Summary:", 10, y);
        y += 7;
        doc.setFontSize(11);
        doc.text(summary, 10, y);
        y += 10;
      }

      // Add Work Experience and Education dynamically (similar to how we did in docx)
      // Add other sections (Skills, Certifications, etc.)

      doc.save("CV.pdf");
    }

    function addWorkExperience() {
      const container = document.getElementById('work-experience-container');
      const workExperienceDiv = document.createElement('div');
      workExperienceDiv.classList.add('work-experience');
      workExperienceDiv.innerHTML = `
        <input type="text" placeholder="Job Title">
        <input type="text" placeholder="Company">
        <input type="date" placeholder="From Date">
        <input type="date" placeholder="To Date">
        <button onclick="removeWorkExperience(this)">Delete</button>
      `;
      container.appendChild(workExperienceDiv);
    }

    function removeWorkExperience(button) {
      button.parentElement.remove();
    }

    function addEducation() {
      const container = document.getElementById('education-container');
      const educationDiv = document.createElement('div');
      educationDiv.classList.add('education');
      educationDiv.innerHTML = `
        <input type="text" placeholder="Degree/Qualification">
        <input type="text" placeholder="Institution">
        <input type="date" placeholder="Start Date">
        <input type="date" placeholder="End Date">
        <button onclick="removeEducation(this)">Delete</button>
      `;
      container.appendChild(educationDiv);
    }

    function removeEducation(button) {
      button.parentElement.remove();
    }
  </script>
</body>
</html>
